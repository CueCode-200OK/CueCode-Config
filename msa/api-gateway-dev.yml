# =========================================
# API-GATEWAY (dev) - Spring Cloud Config
# ëª©ì : ê°œë°œ/ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©. ë¡œê·¸Â·Actuator ì „ë©´ ê°œë°©, CORS ì™„í™”, ê¸´ í† í° ë§Œë£Œì‹œê°„.
# =========================================
server:
  port: 13000                    # ê²Œì´íŠ¸ì›¨ì´ HTTP í¬íŠ¸
  shutdown: graceful             # ìš”ì²­ ì²˜ë¦¬ í›„ ì •ìƒ ì¢…ë£Œ (ê°œë°œ í¸ì˜)

spring:
  application:
    name: api-gateway       # Config/ë¡œê·¸ ì‹ë³„ìš© ì„œë¹„ìŠ¤ëª…
  config:
    activate:
      on-profile: dev            # ì´ íŒŒì¼ì€ dev í”„ë¡œí•„ì—ì„œë§Œ í™œì„±í™”
  cloud:
    discovery:
      enabled: false
    gateway:
      # --- ëª¨ë“  ë¼ìš°íŒ…ì— ì ìš©ë  ê¸°ë³¸ í•„í„° ---
      default-filters:
        - AddRequestHeader=X-Gateway-Secret, cue-code-secret-key-for-internal-communication
        - StripPrefix=1

      # --- ğŸ’¡[ìˆ˜ì •] ìµœì‹  ë²„ì „ì— ë§ê²Œ êµ¬ì¡° ë³€ê²½ ---
      server:
        webflux:
          globalcors:
            cors-configurations:
              '[/**]':
                allowed-origins: "http://localhost:14000,http://localhost:3000,http://127.0.0.1:3000"
                allowed-methods: [GET, POST, PUT, DELETE, OPTIONS]
                allowed-headers: "*"
                allow-credentials: true
          # --- 'routes' ì„¤ì •ì„ ì´ ìœ„ì¹˜ë¡œ ì´ë™ ---
          routes:
            # 1. Motion-Service ë¼ìš°íŒ…
            - id: motion_service_route
              uri: ${service.uri.motion}
              predicates:
                - Path=/api/motions/**

            - id: motion_service_websocket_route
              uri: ws://localhost:15000
              predicates:
                - Path=/ws/motion

            # 2. User-Service ë¼ìš°íŒ… (API ê²½ë¡œë³„ë¡œ ì„¸ë¶„í™”)
            - id: user_login_route
              uri: ${service.uri.user}
              predicates:
                - Path=/api/login/**
            - id: user_users_route
              uri: ${service.uri.user}
              predicates:
                - Path=/api/users/**
            - id: user_manager_route
              uri: ${service.uri.user}
              predicates:
                - Path=/api/manager/**
            - id: user_patient_route
              uri: ${service.uri.user}
              predicates:
                - Path=/api/patient/**
            - id: user_user_info_route
              uri: ${service.uri.user}
              predicates:
                - Path=/api/user/**
            - id: user_reg_route
              uri: ${service.uri.user}
              predicates:
                - Path=/api/reg/**
            - id: user-contact
              uri: ${service.uri.user}
              predicates:
                - Path=/api/users/contact/**

# Actuator ì„¤ì • (ìµœì‹  ë°©ì‹)
management:
  server:
    address: localhost           # Actuatorë¥¼ ë¡œì»¬ì—ì„œë§Œ ë…¸ì¶œ (ê°œë°œ)
    port: 13001                  # Actuator í¬íŠ¸(ì„œë²„ì™€ ë¶„ë¦¬)
  endpoints:
    web:
      exposure:
        include: "*"             # ê°œë°œì€ ì „ë¶€ ë…¸ì¶œ(beans, env ë“±) â€” ìš´ì˜ì—ì„  ê¸ˆì§€!
  endpoint:
    health:
      show-details: always       # ìƒì„¸ í—¬ìŠ¤ ì •ë³´ í‘œì‹œ (ê°œë°œ ë””ë²„ê¹…ìš©)

logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: TRACE
    org.springframework.security: TRACE # Security ìƒì„¸ ë¡œê·¸ í™œì„±í™”
    reactor.netty.http.client: TRACE # Netty í´ë¼ì´ì–¸íŠ¸ ìƒì„¸ ë¡œê·¸ í™œì„±í™”

# JWT (ê°œë°œìš©) â€” ê²Œì´íŠ¸ì›¨ì´ì™€ í† í° ë°œê¸‰/ê²€ì¦ ì„œë¹„ìŠ¤ê°€ 'ë™ì¼í•œ í‚¤'ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
jwt:
  token:
    creator: cuecoder            # iss ë“± ë©”íƒ€ë¡œ í™œìš© ê°€ëŠ¥
    access:
      valid:
        time: "600"              # Access Token ìœ íš¨ì‹œê°„(ì´ˆ) â€” 10ë¶„
      name: jwtAccessToken
    refresh:
      valid:
        time: "7200"             # Refresh Token ìœ íš¨ì‹œê°„(ì´ˆ) â€” 2ì‹œê°„
      name: jwtRefreshToken
  secret:
    key: "Ixp3HCXOS5Hi0py81JF610NG5nvySPjBq3VQXPmwsLI="

# Service URIs for local development
service:
  uri:
    user: http://localhost:11000
    front: http://localhost:14000
    motion: http://localhost:15000